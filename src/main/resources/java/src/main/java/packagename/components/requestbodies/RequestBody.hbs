{{> _helper_header }}

{{#with requestBody}}
package {{packageName}}.components.requestbodies;

{{#if refInfo}}

public class {{jsonPathPiece.pascalCase}} extends {{refInfo.refModule}} {}
{{else}}
import {{packageName}}.requestbody.RequestBodySerializer;
import {{packageName}}.requestbody.RequestBody;
import {{packageName}}.mediatype.MediaType;
    {{#each content}}
        {{#with schema}}
            {{#if refInfo}}
                {{#with getDeepestRef}}
import {{{packageName}}}.{{subpackage}}.{{containerJsonPathPiece.pascalCase}};
                {{/with}}
            {{/if}}
import {{{packageName}}}.{{subpackage}}.{{containerJsonPathPiece.pascalCase}};
        {{/with}}
    {{/each}}

import java.util.AbstractMap;
import java.util.Map;

public class {{jsonPathPiece.pascalCase}} extends RequestBodySerializer {
    {{#each content}}

    public static class {{@key.pascalCase}}MediaType extends MediaType<{{#with this}}{{#with schema}}{{containerJsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}{{/with}}{{/with}}> {
        public {{@key.pascalCase}}MediaType() {
            super({{#with this}}{{#with schema}}{{containerJsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}.getInstance(){{/with}}{{/with}});
        }
    }
    {{/each}}

    public {{jsonPathPiece.pascalCase}}() {
        super(
            Map.ofEntries(
    {{#each content}}
                new AbstractMap.SimpleEntry<>("{{{@key.original}}}", new {{@key.pascalCase}}MediaType()){{#unless @last}},{{/unless}}
    {{/each}}
            ),
            {{#if required}}true{{else}}false{{/if}}
        );
    }

    public static abstract sealed class {{jsonPathPiece.pascalCase}}RequestBody permits {{#each content}}{{jsonPathPiece.pascalCase}}{{@key.pascalCase}}RequestBody{{#unless @last}}, {{/unless}}{{/each}} {}
    {{#each content}}
    public static final class {{jsonPathPiece.pascalCase}}{{@key.pascalCase}}RequestBody extends {{jsonPathPiece.pascalCase}}RequestBody implements RequestBody<{{#with this}}{{#with schema}}{{containerJsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}Boxed{{/with}}{{/with}}> {
        public final String contentType;
        public final {{#with this}}{{#with schema}}{{containerJsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}Boxed{{/with}}{{/with}} body;
        public {{jsonPathPiece.pascalCase}}{{@key.pascalCase}}RequestBody({{#with this}}{{#with schema}}{{containerJsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}Boxed{{/with}}{{/with}} body) {
            contentType = "{{{@key.original}}}";
            body = body;
        }
    }
    {{/each}}
}
{{/if}}
{{/with}}