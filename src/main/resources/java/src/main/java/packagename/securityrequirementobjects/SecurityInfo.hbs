{{#if security.subpackage}}
package {{{packageName}}}.{{security.subpackage}};
{{else}}
package {{{packageName}}};
{{/if}}

import {{{packageName}}}.exceptions.UnsetPropertyException;
{{#each security}}
import {{{packageName}}}.{{subpackage}}.{{jsonPathPiece.pascalCase}};
{{/each}}
import {{{packageName}}}.securityrequirementobjects.SecurityRequirementObject;
import {{{packageName}}}.securityrequirementobjects.SecurityRequirementObjectProvider;
import org.checkerframework.checker.nullness.qual.Nullable;

{{#eq security.length 1}}
import java.util.AbstractMap;
{{else}}
import java.util.HashMap;
{{/eq}}
import java.util.Map;
import java.util.EnumMap;

public class {{security.jsonPathPiece.pascalCase}} implements SecurityRequirementObjectProvider<{{security.jsonPathPiece.pascalCase}}.SecurityIndex> {
    final private Securities securities;
    final private SecurityIndex securityIndex;

    public {{security.jsonPathPiece.pascalCase}}(Securities securities, SecurityIndex securityIndex) {
        this.securities = securities;
        this.securityIndex = securityIndex;
    }
{{#each security}}

    public interface SetterFor{{jsonPathPiece.pascalCase}} <T> {
        Map<SecurityIndex, SecurityRequirementObject> getInstance();
        T getBuilderAfter{{jsonPathPiece.pascalCase}}(Map<SecurityIndex, SecurityRequirementObject> instance);
        {{> src/main/java/packagename/securityrequirementobjects/_SecurityRequirementObjectSetter methodName=jsonPathPiece.camelCase getBuilderMethod=(join "getBuilderAfter" jsonPathPiece.pascalCase "") }}
    }
{{/each}}

    public static class Securities {
        private final EnumMap<SecurityIndex, SecurityRequirementObject> securities;

        {{#eq security.length 1}}
            {{#each security}}
        public Securities({{jsonPathPiece.pascalCase}} security{{@index}}) {
            securities = new EnumMap<>(
                Map.ofEntries(
                    new AbstractMap.SimpleEntry<>(
                        SecurityIndex.SECURITY_{{@index}},
                        security{{@index}}
                    )
                )
            );
        }
            {{/each}}
        {{else}}
            {{#each security}}
        public Securities({{jsonPathPiece.pascalCase}} security{{@index}}) {
            securities = new EnumMap<>(Map.of(SecurityIndex.SECURITY_{{@index}}, security{{@index}}));
        }
            {{/each}}
        public Securities(
            {{#each security}}
            @Nullable {{jsonPathPiece.pascalCase}} security{{@index}}{{#unless @last}},{{/unless}}
            {{/each}}
        ) {
            var secMap = new HashMap<SecurityIndex, SecurityRequirementObject>();
            {{#each security}}
            if (security{{@index}} != null) {
                secMap.put(SecurityIndex.SECURITY_{{@index}}, security{{@index}});
            }
            {{/each}}
            if (secMap.isEmpty()) {
                throw new RuntimeException("Invalid empty input for securities, set at least one of them;");
            }
            securities = new EnumMap<>(secMap);
        }
        {{/eq}}

        public SecurityRequirementObject get(SecurityIndex securityIndex) {
            if (securities.containsKey(securityIndex)) {
                return get(securityIndex);
            }
            throw new UnsetPropertyException(securityIndex+" is unset");
        }
    }

    public enum SecurityIndex {
        {{#each security}}
        SECURITY_{{@index}}{{#unless @last}},{{/unless}}
        {{/each}}
    }

    public SecurityRequirementObject getSecurityRequirementObject(@Nullable SecurityIndex securityIndex) {
        if (securityIndex == null) {
            return securities.get(this.securityIndex);
        }
        return securities.get(securityIndex);
    }
}