package {{{packageName}}}.configurations;

{{#gt allSecurity.size 0}}
import {{{packageName}}}.exceptions.UnsetPropertyException;
import {{{packageName}}}.securityrequirementobjects.SecurityRequirementObject;
{{/gt}}
import {{{packageName}}}.servers.Server;
{{#each allServers}}
    {{#if subpackage}}
import {{{packageName}}}.{{subpackage}}.{{jsonPathPiece.pascalCase}};
    {{else}}
import {{packageName}}.{{jsonPathPiece.pascalCase}};
    {{/if}}
{{/each}}
{{#each allSecurity}}
    {{#if subpackage}}
import {{{packageName}}}.{{subpackage}}.{{jsonPathPiece.pascalCase}};
    {{else}}
import {{packageName}}.{{jsonPathPiece.pascalCase}};
    {{/if}}
{{/each}}
{{#if securitySchemes}}
import {{packageName}}.securityschemes.SecurityScheme;
import {{packageName}}.exceptions.UnsetPropertyException;
{{/if}}
import org.checkerframework.checker.nullness.qual.Nullable;

import java.time.Duration;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.HashMap;

public class ApiConfiguration {
    private final ServerInfo serverInfo;
    private final ServerIndexInfo serverIndexInfo;
    {{#gt allSecurity.size 0}}
    private final SecurityInfo securityInfo;
    private final SecurityIndexInfo securityIndexInfo;
    {{/gt}}
    private final @Nullable Duration timeout;
    {{#if securitySchemes}}
    private final Map<Class<? extends SecurityScheme>, SecurityScheme> securitySchemeInfo;
    {{/if}}

    public ApiConfiguration() {
        serverInfo = new ServerInfo();
        serverIndexInfo = new ServerIndexInfo();
    {{#gt allSecurity.size 0}}
        securityInfo = new SecurityInfo();
        securityIndexInfo = new SecurityIndexInfo();
    {{/gt}}
    {{#if securitySchemes}}
        securitySchemeInfo = new HashMap<>();
    {{/if}}
        timeout = null;
    }

    public ApiConfiguration(ServerInfo serverInfo, ServerIndexInfo serverIndexInfo{{#if securitySchemes}}, List<SecurityScheme> securitySchemes{{/if}}{{#gt allSecurity.size 0}}, SecurityIndexInfo securityIndexInfo{{/gt}}, Duration timeout) {
        this.serverInfo = serverInfo;
        this.serverIndexInfo = serverIndexInfo;
    {{#gt allSecurity.size 0}}
        this.securityInfo = new SecurityInfo();
        this.securityIndexInfo = securityIndexInfo;
    {{/gt}}
    {{#if securitySchemes}}
        securitySchemeInfo = new HashMap<>();
        for (SecurityScheme securityScheme: securitySchemes) {
            securitySchemeInfo.put(securityScheme.getClass(), securityScheme);
        }
    {{/if}}
        this.timeout = timeout;
    }

    public static class ServerInfo {
    {{#each allServers}}
        protected final {{jsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}1 {{jsonPathPiece.camelCase}};
    {{/each}}

        public ServerInfo() {
    {{#each allServers}}
            {{jsonPathPiece.camelCase}} = new {{jsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}1();
    {{/each}}
        }

        public ServerInfo(
    {{#each allServers}}
            {{jsonPathPiece.pascalCase}}. @Nullable {{jsonPathPiece.pascalCase}}1 {{jsonPathPiece.camelCase}}{{#unless @last}},{{/unless}}
    {{/each}}
        ) {
    {{#each allServers}}
            this.{{jsonPathPiece.camelCase}} = Objects.requireNonNullElseGet({{jsonPathPiece.camelCase}}, {{jsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}1::new);
    {{/each}}
        }
    }

    public static class ServerIndexInfo {
    {{#each allServers}}
        protected {{jsonPathPiece.pascalCase}}. @Nullable ServerIndex {{jsonPathPiece.camelCase}}ServerIndex;
    {{/each}}
        public ServerIndexInfo() {}
    {{#each allServers}}

        public ServerIndexInfo {{jsonPathPiece.camelCase}}ServerIndex({{jsonPathPiece.pascalCase}}.ServerIndex serverIndex) {
            this.{{jsonPathPiece.camelCase}}ServerIndex = serverIndex;
            return this;
        }
    {{/each}}
    }
    {{#each allServers}}

    public Server getServer({{jsonPathPiece.pascalCase}}. @Nullable ServerIndex serverIndex) {
        var serverProvider = serverInfo.{{jsonPathPiece.camelCase}};
        if (serverIndex == null) {
            {{jsonPathPiece.pascalCase}}. @Nullable ServerIndex configServerIndex = serverIndexInfo.{{jsonPathPiece.camelCase}}ServerIndex;
            if (configServerIndex == null) {
                throw new RuntimeException("{{jsonPathPiece.camelCase}}ServerIndex is unset");
            }
            return serverProvider.getServer(configServerIndex);
        }
        return serverProvider.getServer(serverIndex);
    }
    {{/each}}
    {{#gt allSecurity.size 0}}

    public static class SecurityInfo {
        {{#each allSecurity}}
        protected final {{jsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}1 {{jsonPathPiece.camelCase}};
        {{/each}}

        public SecurityInfo() {
        {{#each allSecurity}}
            this.{{jsonPathPiece.camelCase}} = new {{jsonPathPiece.pascalCase}}.{{jsonPathPiece.pascalCase}}1();
        {{/each}}
        }
    }

    public static class SecurityIndexInfo {
        {{#each allSecurity}}
        public {{jsonPathPiece.pascalCase}}. @Nullable SecurityIndex {{jsonPathPiece.camelCase}}SecurityIndex;
        {{/each}}

        public SecurityIndexInfo() {}
        {{#each allSecurity}}

        public SecurityIndexInfo {{jsonPathPiece.camelCase}}SecurityIndex({{jsonPathPiece.pascalCase}}.SecurityIndex securityIndex) {
            this.{{jsonPathPiece.camelCase}}SecurityIndex = securityIndex;
            return this;
        }
        {{/each}}
    }

        {{#each allSecurity}}
    public SecurityRequirementObject getSecurityRequirementObject({{jsonPathPiece.pascalCase}}. @Nullable SecurityIndex securityIndex) {
        var securityInfoInstance = securityInfo.{{jsonPathPiece.camelCase}};
        if (securityIndex == null) {
            {{jsonPathPiece.pascalCase}}. @Nullable SecurityIndex configSecurityIndex = securityIndexInfo.{{jsonPathPiece.camelCase}}SecurityIndex;
            if (configSecurityIndex == null) {
                throw new RuntimeException("{{jsonPathPiece.camelCase}}SecurityIndex is unset");
            }
            return securityInfoInstance.getSecurityRequirementObject(configSecurityIndex);
        }
        return securityInfoInstance.getSecurityRequirementObject(securityIndex);
    }
        {{/each}}
    {{/gt}}
    {{#if securitySchemes}}

    public SecurityScheme getSecurityScheme(Class<? extends SecurityScheme> securitySchemeClass) {
        @Nullable SecurityScheme securityScheme = securitySchemeInfo.get(securitySchemeClass);
        if (securityScheme == null) {
            throw new RuntimeException("SecurityScheme of class " + securitySchemeClass + "cannot be returned because it is unset. Pass in an instance of it in securitySchemes when instantiating ApiConfiguration.");
        }
        return securityScheme;
    }
    {{/if}}

    public Map<String, List< String>> getDefaultHeaders() {
        return new HashMap<>();
    }

    public @Nullable Duration getTimeout() {
        return timeout;
    }
}